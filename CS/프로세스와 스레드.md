## ✨ 프로세스와 스레드
### 프로세스 개요

* 프로세스 : 실행 중인 프로그램
* 포그라운드 프로세스 : 사용자가 보는 앞에서 실행되는 프로세스
* 백그라운드 프로세스 : 사용자가 보지 못하는 뒤에서 실행되는 프로세스

</br>
</br>

### 프로세스 제어 블록(PCB)

**프로세스 제어 블록(PCB)** 은 프로세스와 관련된 정보를 저장하는 자료 구조로, 운영체제는 이 PCB를 이용해 프로세스의 실행 순서를 관리하고, 
CPU를 비롯한 자원을 배분한다. </br>

**PCB에 담기는 정보**

- 프로세스 ID(PID)
- 레지스터 값
- 프로세스 상태
- CPU 스케줄링 정보
- 메모리 관리 정보
- 사용한 파일과 입출력장치 목록

</br>
</br>

### 문맥 교환
> 하나의 프로세스에서 다른 프로세스로 실행 순서가 넘어가게 되면 직전까지 실행되던 프로세스 A의 중간 정보(문맥)를 백업해야 다음 차례가 왔을 때 이전까지 실행했던 내용에 이어 다시 실행을 재개할 수 있다. </br>

- 문맥 : 하나의 프로세스 수행을 재개하기 위해 기억해야 할 정보
- 문맥 교환 : 기존 프로세스 문맥을 PCB에 백업하고, 새로운 프로세스를 실행하기 위해 문맥을 PCB로부터 복구하여 새로운 프로세스를 실행하는 것

</br>
</br>

### 프로세스의 메모리 영역
> 하나의 프로세스는 사용자 영역에 크게 코드 영역, 데이터 영역, 힙 영역, 스택 영역으로 나뉘어 저장된다. </br>
</br>


1. 코드 영역

- 텍스트 영역
- 기계어로 이루어진 명령어가 저장
- 읽기 전용 공간
- 정적 할당 영역

</br>

2. 데이터 영역

- 프로그램이 실행되는 동안 유지할 데이터가 저장되는 공간 (전역 변수)
- 정적 할당 영역

</br>

3. 힙 영역

- 사용자가 직접 할당할 수 있는 저장공간
- 힙 영역에 메모리 공간을 할당했다면 언젠가는 해당 공간을 반환해야 하며, 그렇지 않을 경우 **메모리 누수** 발생

</br>

4. 스택 영역

- 데이터가 일시적으로 저장되는 공간 (매개 변수, 지역 변수)
- 일시적으로 저장할 데이터는 스택 영역에 `PUSH`, 더 이상 필요하지 않은 데이터는 `POP`

</br>

<img width="420" alt="image" src="https://github.com/GYURI-PARK/TIL_iOS/assets/93391058/8d796b6c-1ed2-4045-ada2-f50aaa67875f">

> 힙 영역은 메모리의 낮은 주소에서 높은 주소로 할당되고, 스택 영역은 높은 주소에서 낮은 주소로 할당된다.

</br>
</br>

### 프로세스 상태

1. 생성 상태(new) : 이제 막 메모리에 적재되어 PCB를 할당받은 상태
2. 준비 상태(ready) : 기다리고 있는 상태
  * 디스패치 : 준비 상태인 프로세스가 실행 상태로 전환되는 것
3. 실행 상태(running) : CPU를 할당받아 실행 중인 상태
  * 프로세스가 할당된 시간을 모두 사용한다면(타이머 인터럽트가 발생하면) 다시 준비 상태가 됨
  * 실행 도중 입출력장치를 사용하여 입출력 장치의 작업이 끝날 때까지 기다려야 한다면 대기 상태가 됨
4. 대기 상태(blocked) : 입출력장치의 작업을 기다리는 상태
5. 종료 상태(terminated) : 프로세스가 종료된 상태

</br>

<img width="759" alt="image" src="https://github.com/GYURI-PARK/TIL_iOS/assets/93391058/2ec010a6-dfc0-4bd9-b531-bdfe1852a989">

</br>
</br>

### 프로세스 계층 구조 및 프로세스 생성 기법

* 부모 프로세스 : 새 프로세스를 생성한 프로세스
* 자식 프로세스 : 부모 프로세스에 의해 생성된 프로세스
* fork : 자기 자신 프로세스의 복사본을 자식 프로세스로 생성하는 시스템 호출
* exec : 자신의 메모리 공간을 새로운 프로그램으로 덮어쓰는 시스템 호출 </br>
  exec를 호출하면 코드 영역과 데이터 영역의 내용이 실행할 프로그램의 내용으로 바뀌고, 나머지 영역은 초기화

</br>
</br>

### 프로세스와 스레드

* 스레드 : 프로세스를 구성하는 실행의 흐름 단위
* 단일 스레드 프로세스 : 실행의 흐름 단위가 하나인 프로세스

</br>

각각의 스레드는 프로그램 카운터 값을 비롯한 레지스터 값, 스택을 가지고 있기에 스레드마다 각기 다른 코드를 실행할 수 있다. </br>
이 때 프로세스의 스레드들은 실행에 필요한 최소한의 정보(**프로그램 카운터를 포함한 레지스터, 스택**)만을 유지한 채 프로세스 자원을 공유하며 실행된다. </br>
**프로세스 자원을 공유**한다는 것이 스레드의 핵심이다. </br>

</br>

### 멀티프로세스와 멀티스레드

* 멀티프로세스 : 여러 프로세스를 동시에 실행하는 것
* 멀티스레드 : 여러 스레드로 프로세스를 동시에 실행하는 것

</br>

둘의 결과는 같을 수 있지만, 프로세스끼리는 자원을 공유하지 않지만 스레드끼리는 같은 프로세스 내의 자원을 공유한다는 점에서 큰 차이가 있다. </br>

![image](https://github.com/GYURI-PARK/TIL_iOS/assets/93391058/ce878190-1494-45e4-b4d3-d62d4f92f42e)













